<div class="page-container">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">All Complaints</h1>
    <p class="page-subtitle">View and manage all complaints in the system</p>
  </div>

  <!-- Stats Cards - Including all statuses -->
  <div class="stats-container">
    <div class="stat-card pending">
      <div class="stat-number">{{ getPendingCount() }}</div>
      <div class="stat-label">PENDING</div>
    </div>
    <div class="stat-card progress">
      <div class="stat-number">{{ getProgressCount() }}</div>
      <div class="stat-label">IN PROGRESS</div>
    </div>
    <div class="stat-card resolved">
      <div class="stat-number">{{ getResolvedCount() }}</div>
      <div class="stat-label">RESOLVED</div>
    </div>
    <div class="stat-card total">
      <div class="stat-number">{{ getTotalCount() }}</div>
      <div class="stat-label">TOTAL</div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-container">
    <div class="filter-section">
      <div class="filter-label">Filter by Status:</div>
      <div class="filter-buttons">
        <button 
          class="filter-btn" 
          [class.active]="selectedStatus === 'All'"
          (click)="setStatus('All')">
          All
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedStatus === 'PENDING'"
          (click)="setStatus('PENDING')">
          Pending
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedStatus === 'WORK_ON_PROGRESS'"
          (click)="setStatus('WORK_ON_PROGRESS')">
          In Progress
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedStatus === 'RESOLVED'"
          (click)="setStatus('RESOLVED')">
          Resolved
        </button>
      </div>
    </div>
    
    <div class="search-section">
      <div class="search-label">Search:</div>
      <div class="search-box">
        <input
          type="text"
          class="search-input"
          placeholder="Search by title, area, officer..."
          [(ngModel)]="searchText"
        />
        <span class="search-icon">ğŸ”</span>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading complaints...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredComplaints.length === 0" class="empty-state">
    <p>No complaints found matching your criteria.</p>
    <button class="reset-btn" (click)="searchText = ''; setStatus('All')">
      Reset Filters
    </button>
  </div>

  <!-- Complaints List -->
  <div *ngIf="!isLoading && filteredComplaints.length > 0" class="complaints-list">
    <div class="complaint-card" *ngFor="let complaint of filteredComplaints">
      <div class="card-header">
        <h3 class="complaint-title">{{ complaint.title }}</h3>
        <div class="status-badge" [ngClass]="getStatusBadgeClass(complaint.status)">
          {{ getStatusText(complaint.status) }}
        </div>
      </div>
      
      <div class="card-body">
        <p class="complaint-description">{{ complaint.description }}</p>
        
        <div class="complaint-details">
          <div class="detail-item">
            <span class="detail-icon">ğŸ“</span>
            <span class="detail-label">Area:</span>
            <span class="detail-value">{{ complaint.area_name }}</span>
          </div>
          
          <div class="detail-item" *ngIf="userRole === 'USER' || userRole === 'ADMIN'">
            <span class="detail-icon">ğŸ‘®</span>
            <span class="detail-label">Officer:</span>
            <span class="detail-value">{{ complaint.officer || 'Not assigned' }}</span>
          </div>
          
          <div class="detail-item" *ngIf="userRole === 'OFFICER' || userRole === 'ADMIN'">
            <span class="detail-icon">ğŸ‘¤</span>
            <span class="detail-label">Created by:</span>
            <span class="detail-value">{{ complaint.user }}</span>
          </div>
        </div>
      </div>
      
      <div class="card-actions">
        <a 
          *ngIf="complaint.location_link" 
          [href]="complaint.location_link" 
          target="_blank" 
          class="action-btn location-btn">
          ğŸ—ºï¸ View Location
        </a>
        
        <button 
          (click)="openDetailModal(complaint)"
          class="action-btn detail-btn">
          ğŸ‘ï¸ View Details
        </button>
        
        <button 
          *ngIf="userRole === 'USER' && complaint.status === 'RESOLVED'" 
          (click)="openReviewModal(complaint)"
          class="action-btn review-btn">
          â­ Add Review
        </button>
        
        <button 
          *ngIf="userRole === 'USER'" 
          (click)="deleteComplaint(complaint.id)"
          class="action-btn delete-btn">
          ğŸ—‘ï¸ Delete
        </button>

        <button 
          *ngIf="complaint.image" 
          (click)="previewImage(complaint.image, complaint.title)"
          class="action-btn preview-btn">
          ğŸ–¼ï¸ Preview Image
        </button>
      </div>
    </div>
  </div>

  <!-- Review Modal -->
  <app-complaint-modal
    *ngIf="showModal"
    [showModal]="showModal"
    [complaint]="selectedComplaint"
    (closeModal)="closeReviewModal()"
    (review)="updateRating($event)">
  </app-complaint-modal>

  <!-- Detail Modal -->
  <app-detail-complaint-modal
    *ngIf="showDetailModal"
    [showModal]="showDetailModal"
    [complaint]="selectedComplaint"
    (closeModal)="closeDetailModal()">
  </app-detail-complaint-modal>

  <div *ngIf="showImagePreview" class="image-preview-modal" (click)="closeImagePreview()">
    <div class="image-preview-content" (click)="$event.stopPropagation()">
      <div class="image-preview-header">
        <h3 class="image-preview-title">{{ previewImageTitle }}</h3>
        <button class="close-btn" (click)="closeImagePreview()">Ã—</button>
      </div>
      <img [src]="previewImageUrl" [alt]="previewImageTitle" class="preview-image">
    </div>
  </div>
</div>
